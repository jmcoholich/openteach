#!/usr/bin/env bash
set -euo pipefail

# Get staged Python files (safe for spaces)
mapfile -d '' FILES < <(git diff --cached --name-only --diff-filter=ACM -z -- '*.py')

# No Python files â†’ allow commit
(( ${#FILES[@]} == 0 )) && exit 0

#echo "ðŸ” Running ruff format..."
#ruff format "${FILES[@]}"

echo "ðŸ”§ Running ruff check --fix..."
ruff check --fix "${FILES[@]}"

# If Ruff changed anything, abort commit
if ! git diff --quiet -- "${FILES[@]}"; then
  echo
  echo "âŒ Ruff made changes."
  echo "ðŸ‘‰ Please review them, git add, and commit again."
  exit 1
fi

echo "âœ… Ruff passed with no changes"

